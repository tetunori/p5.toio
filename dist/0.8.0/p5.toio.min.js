"use strict";class CubeUtil{static clipNumberUInt8(e){return e<0?0:e>255?255:Math.floor(e)}static clipNumberUInt16(e){return e<0?0:e>65535?65535:Math.floor(e)}}class Mat{static isOnMat(e,t){return void 0!==e&&void 0!==t&&(!(e<this.minX||e>this.maxX)&&!(t<this.minY||t>this.maxY))}}class TileMat extends Mat{static getTileCenter(e,t){if(void 0===e||void 0===t)return;if(!this.isValidRow(e)||!this.isValidColumn(t))return;const i=(this.matrixMaxX-this.matrixMinX)/this.matrixColumns,a=this.matrixMinX+i/2,r=(this.matrixMaxY-this.matrixMinY)/this.matrixRows;return{x:a+i*t,y:this.matrixMinY+r/2+r*e}}static getTileMatrixIndex(e,t){if(void 0===e||void 0===t)return;const i=this.getTileRow(t),a=this.getTileColumn(e);return void 0!==i&&void 0!==a&&this.isValidRow(i)&&this.isValidColumn(a)?{row:i,column:a}:void 0}static getTileRow(e){if(void 0===e)return;const t=Math.floor((e-this.matrixMinY)/(this.matrixMaxY-this.matrixMinY)*this.matrixRows);return this.isValidRow(t)?t:void 0}static getTileColumn(e){if(void 0===e)return;const t=Math.floor((e-this.matrixMinX)/(this.matrixMaxX-this.matrixMinX)*this.matrixColumns);return this.isValidColumn(t)?t:void 0}static isValidRow(e){return!(e<0||e>this.matrixRows-1)}static isValidColumn(e){return!(e<0||e>this.matrixColumns-1)}}class ColorTileMat extends TileMat{static getTileColor(e,t){const i=this.getTileRow(t),a=this.getTileColumn(e);return void 0!==i&&void 0!==a?this.tileColorMatrix[i][a]:void 0}}ColorTileMat.minX=545,ColorTileMat.minY=45,ColorTileMat.maxX=955,ColorTileMat.maxY=455,ColorTileMat.centerX=750,ColorTileMat.centerY=250,ColorTileMat.matrixMinX=555,ColorTileMat.matrixMinY=53,ColorTileMat.matrixMaxX=947,ColorTileMat.matrixMaxY=446,ColorTileMat.matrixRows=9,ColorTileMat.matrixColumns=9,ColorTileMat.tileColor={white:"#FFFFFF",red:"#e85654",blue:"#00aeca",green:"#95ba25",yellow:"#f0ac00"},ColorTileMat.cW=ColorTileMat.tileColor.white,ColorTileMat.cR=ColorTileMat.tileColor.red,ColorTileMat.cB=ColorTileMat.tileColor.blue,ColorTileMat.cG=ColorTileMat.tileColor.green,ColorTileMat.cY=ColorTileMat.tileColor.yellow,ColorTileMat.tileColorMatrix=[[ColorTileMat.cW,ColorTileMat.cB,ColorTileMat.cW,ColorTileMat.cY,ColorTileMat.cW,ColorTileMat.cR,ColorTileMat.cW,ColorTileMat.cR,ColorTileMat.cW],[ColorTileMat.cG,ColorTileMat.cW,ColorTileMat.cR,ColorTileMat.cW,ColorTileMat.cB,ColorTileMat.cW,ColorTileMat.cB,ColorTileMat.cW,ColorTileMat.cY],[ColorTileMat.cW,ColorTileMat.cY,ColorTileMat.cW,ColorTileMat.cY,ColorTileMat.cW,ColorTileMat.cG,ColorTileMat.cW,ColorTileMat.cG,ColorTileMat.cW],[ColorTileMat.cB,ColorTileMat.cW,ColorTileMat.cG,ColorTileMat.cW,ColorTileMat.cR,ColorTileMat.cW,ColorTileMat.cB,ColorTileMat.cW,ColorTileMat.cR],[ColorTileMat.cW,ColorTileMat.cR,ColorTileMat.cW,ColorTileMat.cY,ColorTileMat.cW,ColorTileMat.cG,ColorTileMat.cW,ColorTileMat.cG,ColorTileMat.cW],[ColorTileMat.cY,ColorTileMat.cW,ColorTileMat.cB,ColorTileMat.cW,ColorTileMat.cB,ColorTileMat.cW,ColorTileMat.cY,ColorTileMat.cW,ColorTileMat.cR],[ColorTileMat.cW,ColorTileMat.cG,ColorTileMat.cW,ColorTileMat.cR,ColorTileMat.cW,ColorTileMat.cG,ColorTileMat.cW,ColorTileMat.cB,ColorTileMat.cW],[ColorTileMat.cB,ColorTileMat.cW,ColorTileMat.cY,ColorTileMat.cW,ColorTileMat.cB,ColorTileMat.cW,ColorTileMat.cR,ColorTileMat.cW,ColorTileMat.cY],[ColorTileMat.cW,ColorTileMat.cR,ColorTileMat.cW,ColorTileMat.cG,ColorTileMat.cW,ColorTileMat.cY,ColorTileMat.cW,ColorTileMat.cG,ColorTileMat.cW]],ColorTileMat.redTiles=[{row:0,column:5},{row:0,column:7},{row:1,column:2},{row:3,column:4},{row:3,column:8},{row:4,column:1},{row:5,column:8},{row:6,column:3},{row:7,column:6},{row:8,column:1}],ColorTileMat.blueTiles=[{row:0,column:1},{row:1,column:4},{row:1,column:6},{row:3,column:0},{row:3,column:6},{row:5,column:2},{row:5,column:4},{row:6,column:7},{row:7,column:0},{row:7,column:4}],ColorTileMat.greenTiles=[{row:1,column:0},{row:2,column:5},{row:2,column:7},{row:3,column:2},{row:4,column:5},{row:4,column:7},{row:6,column:1},{row:6,column:5},{row:8,column:3},{row:8,column:7}],ColorTileMat.yellowTiles=[{row:0,column:3},{row:1,column:8},{row:2,column:1},{row:2,column:3},{row:4,column:3},{row:5,column:0},{row:5,column:6},{row:7,column:2},{row:7,column:8},{row:8,column:5}],ColorTileMat.whiteTiles=[{row:0,column:0},{row:0,column:2},{row:0,column:4},{row:0,column:6},{row:0,column:8},{row:1,column:1},{row:1,column:3},{row:1,column:5},{row:1,column:7},{row:2,column:0},{row:2,column:2},{row:2,column:4},{row:2,column:6},{row:2,column:8},{row:3,column:1},{row:3,column:3},{row:3,column:5},{row:3,column:7},{row:4,column:0},{row:4,column:2},{row:4,column:4},{row:4,column:6},{row:4,column:8},{row:5,column:1},{row:5,column:3},{row:5,column:5},{row:5,column:7},{row:6,column:0},{row:6,column:2},{row:6,column:4},{row:6,column:6},{row:6,column:8},{row:7,column:1},{row:7,column:3},{row:7,column:5},{row:7,column:7},{row:8,column:0},{row:8,column:2},{row:8,column:4},{row:8,column:6},{row:8,column:8}];class DevMat01 extends Mat{}DevMat01.minX=34,DevMat01.minY=35,DevMat01.maxX=339,DevMat01.maxY=250,DevMat01.centerX=187,DevMat01.centerY=143;class DevMat02 extends Mat{}DevMat02.minX=34,DevMat02.minY=251,DevMat02.maxX=339,DevMat02.maxY=466,DevMat02.centerX=187,DevMat02.centerY=359;class DevMat03 extends Mat{}DevMat03.minX=34,DevMat03.minY=467,DevMat03.maxX=339,DevMat03.maxY=682,DevMat03.centerX=187,DevMat03.centerY=575;class DevMat04 extends Mat{}DevMat04.minX=34,DevMat04.minY=683,DevMat04.maxX=339,DevMat04.maxY=898,DevMat04.centerX=187,DevMat04.centerY=791;class DevMat05 extends Mat{}DevMat05.minX=340,DevMat05.minY=35,DevMat05.maxX=644,DevMat05.maxY=250,DevMat05.centerX=492,DevMat05.centerY=143;class DevMat06 extends Mat{}DevMat06.minX=340,DevMat06.minY=251,DevMat06.maxX=644,DevMat06.maxY=466,DevMat06.centerX=492,DevMat06.centerY=359;class DevMat07 extends Mat{}DevMat07.minX=340,DevMat07.minY=467,DevMat07.maxX=644,DevMat07.maxY=682,DevMat07.centerX=492,DevMat07.centerY=575;class DevMat08 extends Mat{}DevMat08.minX=340,DevMat08.minY=683,DevMat08.maxX=644,DevMat08.maxY=898,DevMat08.centerX=492,DevMat08.centerY=791;class DevMat09 extends Mat{}DevMat09.minX=645,DevMat09.minY=35,DevMat09.maxX=949,DevMat09.maxY=250,DevMat09.centerX=797,DevMat09.centerY=143;class DevMat10 extends Mat{}DevMat10.minX=645,DevMat10.minY=251,DevMat10.maxX=949,DevMat10.maxY=466,DevMat10.centerX=797,DevMat10.centerY=359;class DevMat11 extends Mat{}DevMat11.minX=645,DevMat11.minY=467,DevMat11.maxX=949,DevMat11.maxY=682,DevMat11.centerX=797,DevMat11.centerY=575;class DevMat12 extends Mat{}DevMat12.minX=645,DevMat12.minY=683,DevMat12.maxX=949,DevMat12.maxY=898,DevMat12.centerX=797,DevMat12.centerY=791;class RingMat extends Mat{static isInsideCircle(e,t){const i=e-this.centerX,a=t-this.centerY;return Math.sqrt(i*i+a*a)<this.radius}static isInFrontOfBlueLine(e){return!(e<this.blueLineY)}static isInFrontOfGreenLine(e){return!(e>this.greenLineY)}}RingMat.minX=45,RingMat.minY=45,RingMat.maxX=455,RingMat.maxY=455,RingMat.centerX=250,RingMat.centerY=250,RingMat.radius=190,RingMat.blueLineY=88,RingMat.greenLineY=410,RingMat.startPointBlueSideX=250,RingMat.startPointBlueSideY=198,RingMat.startPointGreenSideX=250,RingMat.startPointGreenSideY=300;class SimpleTileMat extends TileMat{}SimpleTileMat.minX=98,SimpleTileMat.minY=142,SimpleTileMat.maxX=402,SimpleTileMat.maxY=358,SimpleTileMat.centerX=250,SimpleTileMat.centerY=250,SimpleTileMat.matrixMinX=98,SimpleTileMat.matrixMinY=142,SimpleTileMat.matrixMaxX=402,SimpleTileMat.matrixMaxY=358,SimpleTileMat.matrixRows=5,SimpleTileMat.matrixColumns=7;class StandardId{static getIdName(e){for(const t of this.idTable)if(t.id===e)return t.name}static includes(e){for(const t of this.idTable)if(t.name===e)return!0;return!1}}class SimpleCardAlphabet extends StandardId{}SimpleCardAlphabet.names={markA:"markA",markB:"markB",markC:"markC",markD:"markD",markE:"markE",markF:"markF",markG:"markG",markH:"markH",markI:"markI",markJ:"markJ",markK:"markK",markL:"markL",markM:"markM",markN:"markN",markO:"markO",markP:"markP",markQ:"markQ",markR:"markR",markS:"markS",markT:"markT",markU:"markU",markV:"markV",markW:"markW",markX:"markX",markY:"markY",markZ:"markZ"},SimpleCardAlphabet.idTable=[{name:SimpleCardAlphabet.names.markA,id:3670337},{name:SimpleCardAlphabet.names.markB,id:3670338},{name:SimpleCardAlphabet.names.markC,id:3670339},{name:SimpleCardAlphabet.names.markD,id:3670340},{name:SimpleCardAlphabet.names.markE,id:3670341},{name:SimpleCardAlphabet.names.markF,id:3670342},{name:SimpleCardAlphabet.names.markG,id:3670343},{name:SimpleCardAlphabet.names.markH,id:3670344},{name:SimpleCardAlphabet.names.markI,id:3670345},{name:SimpleCardAlphabet.names.markJ,id:3670346},{name:SimpleCardAlphabet.names.markK,id:3670347},{name:SimpleCardAlphabet.names.markL,id:3670348},{name:SimpleCardAlphabet.names.markM,id:3670349},{name:SimpleCardAlphabet.names.markN,id:3670350},{name:SimpleCardAlphabet.names.markO,id:3670351},{name:SimpleCardAlphabet.names.markP,id:3670352},{name:SimpleCardAlphabet.names.markQ,id:3670353},{name:SimpleCardAlphabet.names.markR,id:3670354},{name:SimpleCardAlphabet.names.markS,id:3670355},{name:SimpleCardAlphabet.names.markT,id:3670356},{name:SimpleCardAlphabet.names.markU,id:3670357},{name:SimpleCardAlphabet.names.markV,id:3670358},{name:SimpleCardAlphabet.names.markW,id:3670359},{name:SimpleCardAlphabet.names.markX,id:3670360},{name:SimpleCardAlphabet.names.markY,id:3670361},{name:SimpleCardAlphabet.names.markZ,id:3670362}];class Card extends StandardId{}Card.names={typhoonCard:"typhoonCard",rushCard:"rushCard",autoTackleCard:"autoTackleCard",randomCard:"randomCard",pushPowerUpCard:"pushPowerUpCard",haritePowerUpCard:"haritePowerUpCard",sideAttackCard:"sideAttackCard",easyModeCard:"easyModeCard",leftCard:"leftCard",rightCard:"rightCard",frontCard:"frontCard",backCard:"backCard",goCard:"goCard"},Card.idTable=[{name:Card.names.typhoonCard,id:3670016},{name:Card.names.rushCard,id:3670054},{name:Card.names.autoTackleCard,id:3670018},{name:Card.names.randomCard,id:3670056},{name:Card.names.pushPowerUpCard,id:3670020},{name:Card.names.haritePowerUpCard,id:3670058},{name:Card.names.sideAttackCard,id:3670022},{name:Card.names.easyModeCard,id:3670060},{name:Card.names.leftCard,id:3670024},{name:Card.names.rightCard,id:3670062},{name:Card.names.frontCard,id:3670026},{name:Card.names.backCard,id:3670064},{name:Card.names.goCard,id:3670028}];class GameMark extends StandardId{}GameMark.names={craftFighter:"craftFighter",rythmAndGo:"rythmAndGo",skunkChaser:"skunkChaser",fingerStrike2P:"fingerStrike2P",fingerStrike1P:"fingerStrike1P",freeMove:"freeMove"},GameMark.idTable=[{name:GameMark.names.craftFighter,id:3670048},{name:GameMark.names.rythmAndGo,id:3670052},{name:GameMark.names.skunkChaser,id:3670086},{name:GameMark.names.fingerStrike2P,id:3670050},{name:GameMark.names.fingerStrike1P,id:3670088},{name:GameMark.names.freeMove,id:3670084}];class SimpleCardNumber extends StandardId{}SimpleCardNumber.names={mark0:"mark0",mark1:"mark1",mark2:"mark2",mark3:"mark3",mark4:"mark4",mark5:"mark5",mark6:"mark6",mark7:"mark7",mark8:"mark8",mark9:"mark9"},SimpleCardNumber.idTable=[{name:SimpleCardNumber.names.mark0,id:3670320},{name:SimpleCardNumber.names.mark1,id:3670321},{name:SimpleCardNumber.names.mark2,id:3670322},{name:SimpleCardNumber.names.mark3,id:3670323},{name:SimpleCardNumber.names.mark4,id:3670324},{name:SimpleCardNumber.names.mark5,id:3670325},{name:SimpleCardNumber.names.mark6,id:3670326},{name:SimpleCardNumber.names.mark7,id:3670327},{name:SimpleCardNumber.names.mark8,id:3670328},{name:SimpleCardNumber.names.mark9,id:3670329}];class Skunk extends StandardId{}Skunk.names={blueSkunk:"blueSkunk",greenSkunk:"greenSkunk",yellowSkunk:"yellowSkunk",orangeSkunk:"orangeSkunk",redSkunk:"redSkunk",brownSkunk:"brownSkunk"},Skunk.idTable=[{name:Skunk.names.blueSkunk,id:3670078},{name:Skunk.names.greenSkunk,id:3670042},{name:Skunk.names.yellowSkunk,id:3670080},{name:Skunk.names.orangeSkunk,id:3670044},{name:Skunk.names.redSkunk,id:3670082},{name:Skunk.names.brownSkunk,id:3670046}];class Sticker extends StandardId{}Sticker.names={speedUpSticker:"speedUpSticker",speedDownSticker:"speedDownSticker",wobbleSticker:"wobbleSticker",panicSticker:"panicSticker",spinSticker:"spinSticker",shockSticker:"shockSticker"},Sticker.idTable=[{name:Sticker.names.speedUpSticker,id:3670066},{name:Sticker.names.speedDownSticker,id:3670030},{name:Sticker.names.wobbleSticker,id:3670068},{name:Sticker.names.panicSticker,id:3670032},{name:Sticker.names.spinSticker,id:3670070},{name:Sticker.names.shockSticker,id:3670034}];class SimpleCardSymbol extends StandardId{}SimpleCardSymbol.names={markExclamation:"markExclamation",markUp:"markUp",markQuestion:"markQuestion",markPlus:"markPlus",markMinus:"markMinus",markEqual:"markEqual",markLeft:"markLeft",markDown:"markDown",markRight:"markRight",markMultiple:"markMultiple",markDivision:"markDivision",markPercent:"markPercent"},SimpleCardSymbol.idTable=[{name:SimpleCardSymbol.names.markExclamation,id:3670305},{name:SimpleCardSymbol.names.markUp,id:3670366},{name:SimpleCardSymbol.names.markQuestion,id:3670335},{name:SimpleCardSymbol.names.markPlus,id:3670315},{name:SimpleCardSymbol.names.markMinus,id:3670317},{name:SimpleCardSymbol.names.markEqual,id:3670333},{name:SimpleCardSymbol.names.markLeft,id:3670332},{name:SimpleCardSymbol.names.markDown,id:3670367},{name:SimpleCardSymbol.names.markRight,id:3670334},{name:SimpleCardSymbol.names.markMultiple,id:3670314},{name:SimpleCardSymbol.names.markDivision,id:3670319},{name:SimpleCardSymbol.names.markPercent,id:3670309}];class Id{static getStandardIdName(e){const t=[Card,Skunk,Sticker,GameMark,SimpleCardNumber,SimpleCardAlphabet,SimpleCardSymbol];for(const i of t){const t=i.getIdName(e);if(void 0!==t)return t}return e.toString()}}Id.Card=Card,Id.GameMark=GameMark,Id.Skunk=Skunk,Id.Sticker=Sticker,Id.SimpleCardNumber=SimpleCardNumber,Id.SimpleCardAlphabet=SimpleCardAlphabet,Id.SimpleCardSymbol=SimpleCardSymbol,Id.ColorTileMat=ColorTileMat,Id.RingMat=RingMat,Id.SimpleTileMat=SimpleTileMat,Id.DevMat01=DevMat01,Id.DevMat02=DevMat02,Id.DevMat03=DevMat03,Id.DevMat04=DevMat04,Id.DevMat05=DevMat05,Id.DevMat06=DevMat06,Id.DevMat07=DevMat07,Id.DevMat08=DevMat08,Id.DevMat09=DevMat09,Id.DevMat10=DevMat10,Id.DevMat11=DevMat11,Id.DevMat12=DevMat12;class P5tId extends Id{}class CubeChar{constructor(e){this.uuid="",this.characteristic=void 0,this.errStrInProgress="GATT operation already in progress.",this.timerID=0,this.retryInterval=30,this.executeTime=0,this.fps=15,this.maxRetryCount=20,this.service=e}prepare(){return new Promise((e,t)=>{this.service?this.service.getCharacteristic(this.uuid).then(t=>{this.characteristic=t,e("characteristic resolve")}).catch(e=>{t(e)}):t(new Error("service does not exist."))})}writeValue(e){const t=(new Date).getTime();if(t-this.executeTime>1e3/this.fps){this.executeTime=t;const i=0;return this.writeValueCore(e,i)}return Promise.resolve("writeValue ignored due to issuing too fast!! Please adjust framerate")}writeValueCore(e,t){return new Promise((i,a)=>{t>this.maxRetryCount&&i("writeValue ignored because it reaches max retry count"),void 0!==this.characteristic?this.characteristic.writeValue(e).then(()=>{i("writeValue resolved")}).catch(i=>{-1!==i.message.indexOf(this.errStrInProgress)?(clearTimeout(this.timerID),this.timerID=setTimeout(this.writeValueCore.bind(this,e,t+1),this.retryInterval)):a(i)}):a(new Error("characteristic does not exist."))})}readValue(){return new Promise((e,t)=>{void 0!==this.characteristic?this.characteristic.readValue().then(t=>{e(t)}).catch(e=>{-1!==e.message.indexOf(this.errStrInProgress)?(clearTimeout(this.timerID),this.timerID=setTimeout(this.readValue.bind(this),this.retryInterval)):t(e)}):t(new Error("characteristic does not exist."))})}setFrameRate(e){this.fps=e}}class CubeBatteryChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20108-5b3b-4571-9508-cf3efcd7bbae",this.batteryLevel=0,this.cbBatteryLevelChanged=[]}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;(null==t?void 0:t.value)&&this.setBatteryLevel(t.value)}),this.characteristic.startNotifications().then(()=>this.readBatteryLevel()).then(()=>{e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}getBatteryLevel(){return this.batteryLevel}readBatteryLevel(){return new Promise((e,t)=>{this.readValue().then(t=>{this.setBatteryLevel(t),e("Success")}).catch(e=>{t(e)})})}setBatteryLevel(e){const t=this.batteryLevel;this.batteryLevel=e.getUint8(0),t!==this.batteryLevel&&this.callbackBatteryLevel(this.batteryLevel)}addEventListener(e,t){"change"===e&&this.cbBatteryLevelChanged.push(t),this.callbackBatteryLevel(this.batteryLevel)}callbackBatteryLevel(e){for(const t of this.cbBatteryLevelChanged)null==t||t(e)}}class CubeButtonChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20107-5b3b-4571-9508-cf3efcd7bbae",this.buttonPressed=!1,this.cbBoth=[],this.cbPressed=[],this.cbReleased=[]}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;(null==t?void 0:t.value)&&(this.setButtonStatus(t.value),this.callbackButtonStatus(this.buttonPressed))}),this.characteristic.startNotifications().then(()=>this.readButtonStatus()).then(()=>{this.callbackButtonStatus(this.buttonPressed),e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}isButtonPressed(){return this.buttonPressed}readButtonStatus(){return new Promise((e,t)=>{this.readValue().then(t=>{this.setButtonStatus(t),e("Success")}).catch(e=>{t(e)})})}setButtonStatus(e){const t=e.getUint8(1);this.buttonPressed=128===t}addEventListener(e,t){"press"===e?this.cbPressed.push(t):"release"===e?this.cbReleased.push(t):"both"===e&&this.cbBoth.push(t),this.callbackButtonStatus(this.buttonPressed)}callbackButtonStatus(e){for(const t of this.cbBoth)null==t||t(e);for(const t of this.cbPressed)e&&(null==t||t());for(const t of this.cbReleased)e||null==t||t()}}class CubeIDChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20101-5b3b-4571-9508-cf3efcd7bbae",this.idInfo={positionId:void 0,standardId:void 0},this.cbPositionId=[],this.cbStandardId=[]}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;(null==t?void 0:t.value)&&this.setIdInfo(t.value)}),this.characteristic.startNotifications().then(()=>this.readIdInfo()).then(()=>{e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}getPositionId(){return this.idInfo.positionId}getStandardId(){return this.idInfo.standardId}readIdInfo(){return new Promise((e,t)=>{this.readValue().then(t=>{this.setIdInfo(t),e("Success")}).catch(e=>{t(e)})})}setIdInfo(e){const t=Object.assign({},this.idInfo);if(1===e.getUint8(0)){const i=1,a=3,r=5,n=7,o=9;if(this.idInfo.positionId={centerX:e.getUint16(i,!0),centerY:e.getUint16(a,!0),angle:e.getUint16(r,!0),sensorX:e.getUint16(n,!0),sensorY:e.getUint16(o,!0)},this.isPositionIdUpdated(t.positionId,this.idInfo.positionId))for(const e of this.cbPositionId)null==e||e(this.idInfo.positionId)}else if(2===e.getUint8(0)){const i=1,a=5;if(this.idInfo.standardId={idNum:e.getUint32(i,!0),id:Id.getStandardIdName(e.getUint32(i,!0)),angle:e.getUint16(a,!0)},this.isStandardIdUpdated(t.standardId,this.idInfo.standardId))for(const e of this.cbStandardId)null==e||e(this.idInfo.standardId)}else if(3===e.getUint8(0)){this.idInfo.positionId=void 0;for(const e of this.cbPositionId)null==e||e(this.idInfo.positionId)}else if(4===e.getUint8(0)){this.idInfo.standardId=void 0;for(const e of this.cbStandardId)null==e||e(this.idInfo.standardId)}}isPositionIdUpdated(e,t){return(null==e?void 0:e.centerX)!==(null==t?void 0:t.centerX)||((null==e?void 0:e.centerY)!==(null==t?void 0:t.centerY)||((null==e?void 0:e.angle)!==(null==t?void 0:t.angle)||((null==e?void 0:e.sensorX)!==(null==t?void 0:t.sensorX)||(null==e?void 0:e.sensorY)!==(null==t?void 0:t.sensorY))))}isStandardIdUpdated(e,t){return(null==e?void 0:e.id)!==(null==t?void 0:t.id)||((null==e?void 0:e.idNum)!==(null==t?void 0:t.idNum)||(null==e?void 0:e.angle)!==(null==t?void 0:t.angle))}callbackCurrentInfo(){for(const e of this.cbPositionId)null==e||e(this.idInfo.positionId);for(const e of this.cbStandardId)null==e||e(this.idInfo.standardId)}addEventListener(e,t){"positionid"===e?this.cbPositionId.push(t):"standardid"===e&&this.cbStandardId.push(t),this.callbackCurrentInfo()}}class CubeLightChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20103-5b3b-4571-9508-cf3efcd7bbae",this.cmdId={turnOff:1,turnOn:3}}turnLightOff(){const e=new Uint8Array([this.cmdId.turnOff]);this.writeValue(e)}turnLightOnRGB(e,t,i,a=0){this.turnLightOnRGBA(e,t,i,255,a)}turnLightOnRGBA(e,t,i,a,r=0){const n=new Uint8Array([this.cmdId.turnOn,CubeUtil.clipNumberUInt8(Math.floor(r/10)),1,1,CubeUtil.clipNumberUInt8(Math.floor(e*a/255)),CubeUtil.clipNumberUInt8(Math.floor(t*a/255)),CubeUtil.clipNumberUInt8(Math.floor(i*a/255))]);this.writeValue(n)}}class CubeMotorChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20102-5b3b-4571-9508-cf3efcd7bbae",this.cmdId={motorControl:1,motorControlTimeSpecified:2,motorControlAimSpecified:3,motorControlMultiAimSpecified:4,motorControlAccelerationSpecified:5},this.motorId={left:1,right:2},this.dirId={front:1,back:2},this.sequenceId=0}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;null==t||t.value}),this.characteristic.startNotifications().then(()=>{e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}getMotorDirection(e){return e>=0?this.dirId.front:this.dirId.back}motorControl(e,t){this.motorControlTimeSpecified(e,t)}motorControlTimeSpecified(e,t,i=0){const a=new Uint8Array([this.cmdId.motorControlTimeSpecified,this.motorId.left,this.getMotorDirection(e),CubeUtil.clipNumberUInt8(Math.abs(e)),this.motorId.right,this.getMotorDirection(t),CubeUtil.clipNumberUInt8(Math.abs(t)),CubeUtil.clipNumberUInt8(i)]);this.writeValue(a)}motorControlAimSpecified(e,t,i=CubeMotorChar.moveTypeId.efficient,a=CubeMotorChar.easeTypeId.constant,r=5){const n=new ArrayBuffer(13),o=new DataView(n);let s=0;o.setUint8(s,this.cmdId.motorControlAimSpecified),s+=1,o.setUint8(s,this.sequenceId),s+=1,o.setUint8(s,CubeUtil.clipNumberUInt8(r)),s+=1,o.setUint8(s,CubeUtil.clipNumberUInt8(i)),s+=1,o.setUint8(s,CubeUtil.clipNumberUInt8(t)),s+=1,o.setUint8(s,CubeUtil.clipNumberUInt8(a)),s+=1,o.setUint8(s,0),s+=1,o.setUint16(s,CubeUtil.clipNumberUInt16(e.x),!0),s+=2,o.setUint16(s,CubeUtil.clipNumberUInt16(e.y),!0),s+=2;const l=void 0===e.angle?0:e.angle,d=void 0===e.angleType?CubeMotorChar.angleTypeId.noRotate:e.angleType;o.setUint16(s,CubeUtil.clipNumberUInt16(l+(d<<13)),!0),this.writeValue(n),this.inclementSequenceId()}inclementSequenceId(){this.sequenceId+=1,this.sequenceId>255&&(this.sequenceId=0)}motorControlMultipleAimSpecified(e,t,i=CubeMotorChar.moveTypeId.efficient,a=CubeMotorChar.easeTypeId.constant,r=!1,n=5){const o=8+6*e.length,s=new ArrayBuffer(o),l=new DataView(s);let d=0;l.setUint8(d,this.cmdId.motorControlMultiAimSpecified),d+=1,l.setUint8(d,this.sequenceId),d+=1,l.setUint8(d,CubeUtil.clipNumberUInt8(n)),d+=1,l.setUint8(d,CubeUtil.clipNumberUInt8(i)),d+=1,l.setUint8(d,CubeUtil.clipNumberUInt8(t)),d+=1,l.setUint8(d,CubeUtil.clipNumberUInt8(a)),d+=1,l.setUint8(d,0),d+=1,l.setUint8(d,r?1:0),d+=1;for(const t of e){l.setUint16(d,CubeUtil.clipNumberUInt16(t.x),!0),d+=2,l.setUint16(d,CubeUtil.clipNumberUInt16(t.y),!0),d+=2;const e=void 0===t.angle?0:t.angle,i=void 0===t.angleType?CubeMotorChar.angleTypeId.noRotate:t.angleType;l.setUint16(d,CubeUtil.clipNumberUInt16(e+(i<<13)),!0),d+=2}this.writeValue(new Uint8Array(s)),this.inclementSequenceId()}motorControlAccelerationSpecified(){const e=new Uint8Array([5,50,5,15,0,0,0,0,100]);this.writeValue(e)}}CubeMotorChar.moveTypeId={efficient:0,withoutBack:1,rotate1st:2},CubeMotorChar.easeTypeId={constant:0,accel:1,decel:2,accelDecel:3},CubeMotorChar.angleTypeId={absEfficient:0,absPositiveDir:1,absNegativeDir:2,relPositiveDir:3,relNegativeDir:4,noRotate:5,sameAsCurrent:6};class CubeSensorChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20106-5b3b-4571-9508-cf3efcd7bbae",this.sensorInfo={flat:!1,posture:CubeSensorChar.postureId.top},this.cbFlat=[],this.cbCollision=[],this.cbDoubleTapped=[],this.cbPostureChanged=[]}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;(null==t?void 0:t.value)&&this.setSensorInfo(t.value)}),this.characteristic.startNotifications().then(()=>this.readSensorInfo()).then(()=>{e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}isFlat(){return this.sensorInfo.flat}getPosture(){return this.sensorInfo.posture}readSensorInfo(){return new Promise((e,t)=>{this.readValue().then(t=>{this.setSensorInfo(t),e("Success")}).catch(e=>{t(e)})})}setSensorInfo(e){const t=Object.assign({},this.sensorInfo);if(1===e.getUint8(0)){const i=1,a=2,r=3,n=4;if(e.getUint8(r))for(const e of this.cbDoubleTapped)null==e||e();if(e.getUint8(a))for(const e of this.cbCollision)null==e||e();if(this.sensorInfo.flat=!!e.getUint8(i),t.flat!==this.sensorInfo.flat)for(const e of this.cbFlat)null==e||e(this.sensorInfo.flat);if(this.sensorInfo.posture=this.convertPostureValueToId(e.getUint8(n)),t.posture!==this.sensorInfo.posture)for(const e of this.cbPostureChanged)null==e||e(this.sensorInfo.posture)}}callbackCurrentInfo(){for(const e of this.cbFlat)null==e||e(this.sensorInfo.flat);for(const e of this.cbPostureChanged)null==e||e(this.sensorInfo.posture)}addEventListener(e,t){"flat"===e?this.cbFlat.push(t):"collision"===e?this.cbCollision.push(t):"doubletap"===e?this.cbDoubleTapped.push(t):"posture"===e&&this.cbPostureChanged.push(t),this.callbackCurrentInfo()}convertPostureValueToId(e){return e<1||e>6?"invalid":[CubeSensorChar.postureId.top,CubeSensorChar.postureId.bottom,CubeSensorChar.postureId.back,CubeSensorChar.postureId.front,CubeSensorChar.postureId.right,CubeSensorChar.postureId.left][e-1]}}CubeSensorChar.postureId={top:"top",bottom:"bottom",back:"back",front:"front",right:"right",left:"left"};class CubeSoundChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20104-5b3b-4571-9508-cf3efcd7bbae",this.cmdId={soundEffect:2,playNote:3}}playSE(e){const t=new Uint8Array([this.cmdId.soundEffect,CubeUtil.clipNumberUInt8(e),255]);this.writeValue(t)}playSingleNote(e,t=30){let i=e;i>128&&(i=128);const a=new Uint8Array([this.cmdId.playNote,1,1,CubeUtil.clipNumberUInt8(t),CubeUtil.clipNumberUInt8(i),255]);this.writeValue(a)}playMelody(e){const t=[],i=e.length;t.push(this.cmdId.playNote,1,i);for(const i of e)i.note>128&&(i.note=128),t.push(CubeUtil.clipNumberUInt8(i.duration),CubeUtil.clipNumberUInt8(i.note),255);this.writeValue(new Uint8Array(t))}}CubeSoundChar.seId={enter:0,selected:1,cancel:2,cursor:3,matIn:4,matOut:5,get1:6,get2:7,get3:8,effect1:9,effect2:10};class CubeBase{constructor(e){this.idChar=void 0,this.motorChar=void 0,this.lightChar=void 0,this.sensorChar=void 0,this.batteryChar=void 0,this.soundChar=void 0,this.buttonChar=void 0,this.device=void 0,this.charStatusArray=[!1,!1,!1,!1,!1,!1,!1],this.isConnected=!1,this.device=e}connect(){return new Promise((e,t)=>{const{device:i}=this;if(i){const{gatt:a}=i;a?null==a||a.connect().then(e=>{this.isConnected=!0;return e.getPrimaryService("10b20100-5b3b-4571-9508-cf3efcd7bbae")}).then(i=>{const a=[];a.push(this.idChar=new CubeIDChar(i)),a.push(this.motorChar=new CubeMotorChar(i)),a.push(this.lightChar=new CubeLightChar(i)),a.push(this.sensorChar=new CubeSensorChar(i)),a.push(this.batteryChar=new CubeBatteryChar(i)),a.push(this.soundChar=new CubeSoundChar(i)),a.push(this.buttonChar=new CubeButtonChar(i));for(let i=0;i<a.length;i++){const r=a[i];null==r||r.prepare().then(()=>{this.updateCharState(i,!0)&&e(this)}).catch(e=>{t(e)})}}).catch(e=>{t(e)}):t(new Error("device.gatt does not exist."))}else t(new Error("device: BluetoothDevice does not exist."))})}disconnect(){const{device:e}=this;if(e&&this.isConnected){const{gatt:t}=e;t&&(this.isConnected=!1,t.disconnect(),this.initDeviceInfo())}}initDeviceInfo(){this.idChar=void 0,this.motorChar=void 0,this.lightChar=void 0,this.sensorChar=void 0,this.batteryChar=void 0,this.soundChar=void 0,this.buttonChar=void 0,this.device=void 0}updateCharState(e,t){this.charStatusArray[e]=t;for(const e of this.charStatusArray)if(!e)return!1;return!0}setFrameRate(e){var t,i,a,r,n,o,s;null===(t=this.idChar)||void 0===t||t.setFrameRate(e),null===(i=this.motorChar)||void 0===i||i.setFrameRate(e),null===(a=this.lightChar)||void 0===a||a.setFrameRate(e),null===(r=this.sensorChar)||void 0===r||r.setFrameRate(e),null===(n=this.batteryChar)||void 0===n||n.setFrameRate(e),null===(o=this.soundChar)||void 0===o||o.setFrameRate(e),null===(s=this.buttonChar)||void 0===s||s.setFrameRate(e)}}class Cube{constructor(e){this.x=void 0,this.y=void 0,this.sensorX=void 0,this.sensorY=void 0,this.angle=void 0,this.standardId=void 0,this.flat=void 0,this.posture=void 0,this.buttonPressed=void 0,this.batteryLevel=void 0,this.cube=void 0,this.cube=e,this.registCallback()}connect(){return new Promise((e,t)=>{const{cube:i}=this;i?i.connect().then(()=>{e(this)}).catch(e=>{t(e)}):t(new Error("cube does not exist."))})}disconnect(){const{cube:e}=this;null==e||e.disconnect()}addEventListener(e,t){var i,a,r,n,o,s,l,d,c,u,h,m,C,b,v,p,M,k;switch(e){case"buttonpress":null===(a=null===(i=this.cube)||void 0===i?void 0:i.buttonChar)||void 0===a||a.addEventListener("press",t);break;case"buttonrelease":null===(n=null===(r=this.cube)||void 0===r?void 0:r.buttonChar)||void 0===n||n.addEventListener("release",t);break;case"batterylevelchange":null===(s=null===(o=this.cube)||void 0===o?void 0:o.batteryChar)||void 0===s||s.addEventListener("change",t);break;case"sensorflat":null===(d=null===(l=this.cube)||void 0===l?void 0:l.sensorChar)||void 0===d||d.addEventListener("flat",t);break;case"sensorcollision":null===(u=null===(c=this.cube)||void 0===c?void 0:c.sensorChar)||void 0===u||u.addEventListener("collision",t);break;case"sensordoubletap":null===(m=null===(h=this.cube)||void 0===h?void 0:h.sensorChar)||void 0===m||m.addEventListener("doubletap",t);break;case"sensorposturechange":null===(b=null===(C=this.cube)||void 0===C?void 0:C.sensorChar)||void 0===b||b.addEventListener("posture",t);break;case"positionid":null===(p=null===(v=this.cube)||void 0===v?void 0:v.idChar)||void 0===p||p.addEventListener("positionid",t);break;case"standardid":null===(k=null===(M=this.cube)||void 0===M?void 0:M.idChar)||void 0===k||k.addEventListener("standardid",t)}}registCallback(){var e,t,i,a,r,n,o,s,l,d,c,u,h,m,C,b,v,p;null===(t=null===(e=this.cube)||void 0===e?void 0:e.buttonChar)||void 0===t||t.addEventListener("press",this.onButtonPressed.bind(this)),null===(a=null===(i=this.cube)||void 0===i?void 0:i.buttonChar)||void 0===a||a.addEventListener("release",this.onButtonReleased.bind(this)),null===(n=null===(r=this.cube)||void 0===r?void 0:r.batteryChar)||void 0===n||n.addEventListener("change",this.onBatteryLevelChanged.bind(this)),null===(s=null===(o=this.cube)||void 0===o?void 0:o.sensorChar)||void 0===s||s.addEventListener("flat",this.onFlatChanged.bind(this)),null===(d=null===(l=this.cube)||void 0===l?void 0:l.sensorChar)||void 0===d||d.addEventListener("collision",this.onCollisionOccurred.bind(this)),null===(u=null===(c=this.cube)||void 0===c?void 0:c.sensorChar)||void 0===u||u.addEventListener("doubletap",this.onDoubleTapped.bind(this)),null===(m=null===(h=this.cube)||void 0===h?void 0:h.sensorChar)||void 0===m||m.addEventListener("posture",this.onPostureChanged.bind(this)),null===(b=null===(C=this.cube)||void 0===C?void 0:C.idChar)||void 0===b||b.addEventListener("positionid",this.onPositionIdChanged.bind(this)),null===(p=null===(v=this.cube)||void 0===v?void 0:v.idChar)||void 0===p||p.addEventListener("standardid",this.onStandardIdChanged.bind(this))}onButtonPressed(){this.buttonPressed=!0,"function"==typeof cubeButtonPressed&&cubeButtonPressed()}onButtonReleased(){this.buttonPressed=!1,"function"==typeof cubeButtonReleased&&cubeButtonReleased()}onBatteryLevelChanged(e){this.batteryLevel=e,"function"==typeof cubeBatteryLevelChanged&&cubeBatteryLevelChanged(e)}onFlatChanged(e){this.flat=e,"function"==typeof cubeFlatChanged&&cubeFlatChanged(e)}onCollisionOccurred(){"function"==typeof cubeCollisionOccurred&&cubeCollisionOccurred()}onDoubleTapped(){"function"==typeof cubeDoubleTapped&&cubeDoubleTapped()}onPostureChanged(e){this.posture=e,"function"==typeof cubePostureChanged&&cubePostureChanged(e)}onPositionIdChanged(e){this.x=null==e?void 0:e.centerX,this.y=null==e?void 0:e.centerY,this.sensorX=null==e?void 0:e.sensorX,this.sensorY=null==e?void 0:e.sensorY,this.angle=null==e?void 0:e.angle,void 0!==this.angle&&(this.angle=this.radians(this.angle)),"function"==typeof cubePositionIdChanged&&cubePositionIdChanged(e)}onStandardIdChanged(e){this.standardId=null==e?void 0:e.id,this.angle=null==e?void 0:e.angle,void 0!==this.angle&&(this.angle=this.radians(this.angle)),"function"==typeof cubeStandardIdChanged&&cubeStandardIdChanged(e)}setFrameRate(e){var t;null===(t=this.cube)||void 0===t||t.setFrameRate(e)}turnLightOff(){var e,t;null===(t=null===(e=this.cube)||void 0===e?void 0:e.lightChar)||void 0===t||t.turnLightOff()}turnLightOnRGB(e,t,i,a=0){var r,n;null===(n=null===(r=this.cube)||void 0===r?void 0:r.lightChar)||void 0===n||n.turnLightOnRGB(e,t,i,a)}turnLightOnRGBA(e,t,i,a,r=0){var n,o;null===(o=null===(n=this.cube)||void 0===n?void 0:n.lightChar)||void 0===o||o.turnLightOnRGBA(e,t,i,a,r)}playSE(e){var t,i;null===(i=null===(t=this.cube)||void 0===t?void 0:t.soundChar)||void 0===i||i.playSE(e)}playSingleNote(e,t=30){var i,a;null===(a=null===(i=this.cube)||void 0===i?void 0:i.soundChar)||void 0===a||a.playSingleNote(e,t)}playMelody(e){var t,i;null===(i=null===(t=this.cube)||void 0===t?void 0:t.soundChar)||void 0===i||i.playMelody(e)}stop(){var e,t;return null===(t=null===(e=this.cube)||void 0===e?void 0:e.motorChar)||void 0===t?void 0:t.motorControl(0,0)}move(e,t,i=0){var a,r;return null===(r=null===(a=this.cube)||void 0===a?void 0:a.motorChar)||void 0===r?void 0:r.motorControlTimeSpecified(e,t,i)}moveTo(e,t,i=CubeMotorChar.moveTypeId.efficient,a=CubeMotorChar.easeTypeId.constant,r=5){var n,o;return(null==e?void 0:e.angle)&&(e.angle=this.degrees(e.angle)),null===(o=null===(n=this.cube)||void 0===n?void 0:n.motorChar)||void 0===o?void 0:o.motorControlAimSpecified(e,t,i,a,r)}moveToMulti(e,t,i=CubeMotorChar.moveTypeId.efficient,a=CubeMotorChar.easeTypeId.constant,r=!1,n=5){var o,s;for(const t of e)(null==t?void 0:t.angle)&&(t.angle=this.degrees(t.angle));return null===(s=null===(o=this.cube)||void 0===o?void 0:o.motorChar)||void 0===s?void 0:s.motorControlMultipleAimSpecified(e,t,i,a,r,n)}moveToCube(e,t,i=CubeMotorChar.moveTypeId.efficient,a=CubeMotorChar.easeTypeId.constant,r=5){(null==e?void 0:e.x)&&(null==e?void 0:e.y)&&(this.distanceToCube(e)>30?this.moveTo({x:e.x,y:e.y},t,i,a,r):this.stop())}rotate(e,t=0){var i,a;let r=e,n=-e;return e<0&&(r=-e,n=e),null===(a=null===(i=this.cube)||void 0===i?void 0:i.motorChar)||void 0===a?void 0:a.motorControlTimeSpecified(r,n,t)}turnTo(e,t,i=Cube.rotateTypeId.efficient,a=5){var r,n;let o;switch(i){case Cube.rotateTypeId.clockwise:o=Cube.angleTypeId.absPositiveDir;break;case Cube.rotateTypeId.counterClockwise:o=Cube.angleTypeId.absNegativeDir;break;default:case Cube.rotateTypeId.efficient:o=Cube.angleTypeId.absEfficient}if(this.x&&this.y){const i={x:this.x,y:this.y,angle:this.degrees(e),angleType:o};return null===(n=null===(r=this.cube)||void 0===r?void 0:r.motorChar)||void 0===n?void 0:n.motorControlAimSpecified(i,t,void 0,void 0,a)}}turnToXY(e,t,i,a=Cube.rotateTypeId.efficient,r=5){const n=this.relativeAngleToXY(e,t);let o=i;void 0!==this.angle&&Math.abs(n-this.angle)<Math.PI/6&&(o=10),this.turnTo(n,o,a,r)}turnToCube(e,t,i=Cube.rotateTypeId.efficient,a=5){(null==e?void 0:e.x)&&(null==e?void 0:e.y)&&this.turnToXY(e.x,e.y,t,i,a)}distanceToXY(e,t){if(this.x&&this.y){const i=this.x-e,a=this.y-t;return Math.sqrt(i*i+a*a)}return 0}distanceToCube(e){return(null==e?void 0:e.x)&&(null==e?void 0:e.y)?this.distanceToXY(e.x,e.y):0}relativeAngleToXY(e,t){if(this.x&&this.y){const i=e-this.x,a=t-this.y;return this.normalizeAngleRadian(Math.atan2(a,i))}return 0}degrees(e){const t=180*e/Math.PI;return this.normalizeAngleDegrees(Math.floor(t))}radians(e){const t=e*Math.PI/180;return this.normalizeAngleRadian(t)}normalizeAngleDegrees(e){let t=0;return t=e%360,e<0&&(t+=360),t}normalizeAngleRadian(e){let t=e;for(;t>Math.PI||t<-Math.PI;)t<-Math.PI?t+=2*Math.PI:t>Math.PI&&(t-=2*Math.PI);return t}}Cube.seId=CubeSoundChar.seId,Cube.postureId=CubeSensorChar.postureId,Cube.moveTypeId=CubeMotorChar.moveTypeId,Cube.easeTypeId=CubeMotorChar.easeTypeId,Cube.angleTypeId=CubeMotorChar.angleTypeId,Cube.rotateTypeId={efficient:"efficient",clockwise:"clockwise",counterClockwise:"counterClockwise"},Cube.connectNewCube=()=>new Promise((e,t)=>{CubeConnector.connectNewCube().then(t=>{e(new Cube(t))}).catch(e=>{t(e)})});class CubeScanner{static scanNewCube(){const e={filters:[{services:["10b20100-5b3b-4571-9508-cf3efcd7bbae"]}]};return new Promise((t,i)=>{const a=window.navigator;(null==a?void 0:a.bluetooth)?a.bluetooth.requestDevice(e).then(e=>{const i=new CubeBase(e);t(i)}):i(new Error("navigatorObj.bluetooth does not exist."))})}}class CubeConnector{}CubeConnector.connectNewCube=()=>new Promise((e,t)=>{CubeScanner.scanNewCube().then(e=>e.connect()).then(t=>{e(t)}).catch(e=>{t(e)})});class P5tCube extends Cube{connectP5tCube(){return new Promise((e,t)=>{super.connect().then(()=>{e(this)}).catch(e=>{t(e)})})}onPositionIdChanged(e){(null==e?void 0:e.angle)&&(e.angle=this.convertAngleFromRadians(e.angle)),super.onPositionIdChanged(e)}onStandardIdChanged(e){(null==e?void 0:e.angle)&&(e.angle=this.convertAngleFromRadians(e.angle)),super.onStandardIdChanged(e)}turnLightOn(e,t=0){var i,a;null===(a=null===(i=this.cube)||void 0===i?void 0:i.lightChar)||void 0===a||a.turnLightOnRGBA(red(e),green(e),blue(e),alpha(e),t)}moveTo(e,t,i=CubeMotorChar.moveTypeId.efficient,a=CubeMotorChar.easeTypeId.constant,r=5){(null==e?void 0:e.angle)&&(e.angle=this.convertAngleToRadians(e.angle)),super.moveTo(e,t,i,a,r)}moveToMulti(e,t,i=CubeMotorChar.moveTypeId.efficient,a=CubeMotorChar.easeTypeId.constant,r=!1,n=5){for(const t of e)(null==t?void 0:t.angle)&&(t.angle=this.convertAngleToRadians(t.angle));super.moveToMulti(e,t,i,a,r,n)}turnTo(e,t,i=P5tCube.rotateTypeId.efficient,a=5){const r=this.convertAngleToRadians(e);super.turnTo(r,t,i,a)}turnToXY(e,t,i,a=P5tCube.rotateTypeId.efficient,r=5){let n=this.relativeAngleToXY(e,t),o=i;void 0!==this.angle&&Math.abs(n-this.angle)<Math.PI/6&&(o=10),this.isAngleModeRadians()||(n=Math.floor(degrees(n)),n=this.normalizeAngleDegrees(n)),this.turnTo(n,o,a,r)}convertAngleToRadians(e){let t;return t=this.isAngleModeRadians()?e:radians(e),this.normalizeAngleRadian(t)}convertAngleFromRadians(e){let t;return t=this.isAngleModeRadians()?e:degrees(e),this.normalizeAngleDegrees(t)}isAngleModeRadians(){return 1===sin(Math.PI/2)}}P5tCube.connectNewP5tCube=()=>new Promise((e,t)=>{CubeConnector.connectNewCube().then(t=>{e(new P5tCube(t))}).catch(e=>{t(e)})});