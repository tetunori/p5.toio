class CubeUtil{static clipNumberUInt8(e){return e<0?0:e>255?255:Math.floor(e)}static clipNumberUInt16(e){return e<0?0:e>65535?65535:Math.floor(e)}}class Mat{static isOnMat(e,t){return void 0!==e&&void 0!==t&&(!(e<this.minX||e>this.maxX)&&!(t<this.minY||t>this.maxY))}}class TileMat extends Mat{static getTileCenter(e,t){if(void 0===e||void 0===t)return;if(!this.isValidRow(e)||!this.isValidColumn(t))return;const n=(this.matrixMaxX-this.matrixMinX)/this.matrixColumns,i=this.matrixMinX+n/2,r=(this.matrixMaxY-this.matrixMinY)/this.matrixRows;return{x:i+n*t,y:this.matrixMinY+r/2+r*e}}static getTileMatrixIndex(e,t){if(void 0===e||void 0===t)return;const n=this.getTileRow(t),i=this.getTileColumn(e);return void 0!==n&&void 0!==i&&this.isValidRow(n)&&this.isValidColumn(i)?{row:n,column:i}:void 0}static getTileRow(e){if(void 0===e)return;const t=Math.floor((e-this.matrixMinY)/(this.matrixMaxY-this.matrixMinY)*this.matrixRows);return this.isValidRow(t)?t:void 0}static getTileColumn(e){if(void 0===e)return;const t=Math.floor((e-this.matrixMinX)/(this.matrixMaxX-this.matrixMinX)*this.matrixColumns);return this.isValidColumn(t)?t:void 0}static isValidRow(e){return!(e<0||e>this.matrixRows-1)}static isValidColumn(e){return!(e<0||e>this.matrixColumns-1)}}let ColorTileMat=(()=>{class e extends TileMat{static getTileColor(e,t){const n=this.getTileRow(t),i=this.getTileColumn(e);return void 0!==n&&void 0!==i?this.tileColorMatrix[n][i]:void 0}}return e.minX=545,e.minY=45,e.maxX=955,e.maxY=455,e.centerX=750,e.centerY=250,e.matrixMinX=555,e.matrixMinY=53,e.matrixMaxX=947,e.matrixMaxY=446,e.matrixRows=9,e.matrixColumns=9,e.tileColor={white:"#FFFFFF",red:"#e85654",blue:"#00aeca",green:"#95ba25",yellow:"#f0ac00"},e.cW=e.tileColor.white,e.cR=e.tileColor.red,e.cB=e.tileColor.blue,e.cG=e.tileColor.green,e.cY=e.tileColor.yellow,e.tileColorMatrix=[[e.cW,e.cB,e.cW,e.cY,e.cW,e.cR,e.cW,e.cR,e.cW],[e.cG,e.cW,e.cR,e.cW,e.cB,e.cW,e.cB,e.cW,e.cY],[e.cW,e.cY,e.cW,e.cY,e.cW,e.cG,e.cW,e.cG,e.cW],[e.cB,e.cW,e.cG,e.cW,e.cR,e.cW,e.cB,e.cW,e.cR],[e.cW,e.cR,e.cW,e.cY,e.cW,e.cG,e.cW,e.cG,e.cW],[e.cY,e.cW,e.cB,e.cW,e.cB,e.cW,e.cY,e.cW,e.cR],[e.cW,e.cG,e.cW,e.cR,e.cW,e.cG,e.cW,e.cB,e.cW],[e.cB,e.cW,e.cY,e.cW,e.cB,e.cW,e.cR,e.cW,e.cY],[e.cW,e.cR,e.cW,e.cG,e.cW,e.cY,e.cW,e.cG,e.cW]],e.redTiles=[{row:0,column:5},{row:0,column:7},{row:1,column:2},{row:3,column:4},{row:3,column:8},{row:4,column:1},{row:5,column:8},{row:6,column:3},{row:7,column:6},{row:8,column:1}],e.blueTiles=[{row:0,column:1},{row:1,column:4},{row:1,column:6},{row:3,column:0},{row:3,column:6},{row:5,column:2},{row:5,column:4},{row:6,column:7},{row:7,column:0},{row:7,column:4}],e.greenTiles=[{row:1,column:0},{row:2,column:5},{row:2,column:7},{row:3,column:2},{row:4,column:5},{row:4,column:7},{row:6,column:1},{row:6,column:5},{row:8,column:3},{row:8,column:7}],e.yellowTiles=[{row:0,column:3},{row:1,column:8},{row:2,column:1},{row:2,column:3},{row:4,column:3},{row:5,column:0},{row:5,column:6},{row:7,column:2},{row:7,column:8},{row:8,column:5}],e.whiteTiles=[{row:0,column:0},{row:0,column:2},{row:0,column:4},{row:0,column:6},{row:0,column:8},{row:1,column:1},{row:1,column:3},{row:1,column:5},{row:1,column:7},{row:2,column:0},{row:2,column:2},{row:2,column:4},{row:2,column:6},{row:2,column:8},{row:3,column:1},{row:3,column:3},{row:3,column:5},{row:3,column:7},{row:4,column:0},{row:4,column:2},{row:4,column:4},{row:4,column:6},{row:4,column:8},{row:5,column:1},{row:5,column:3},{row:5,column:5},{row:5,column:7},{row:6,column:0},{row:6,column:2},{row:6,column:4},{row:6,column:6},{row:6,column:8},{row:7,column:1},{row:7,column:3},{row:7,column:5},{row:7,column:7},{row:8,column:0},{row:8,column:2},{row:8,column:4},{row:8,column:6},{row:8,column:8}],e})(),DevMat01=(()=>{class e extends Mat{}return e.minX=34,e.minY=35,e.maxX=339,e.maxY=250,e.centerX=187,e.centerY=143,e})(),DevMat02=(()=>{class e extends Mat{}return e.minX=34,e.minY=251,e.maxX=339,e.maxY=466,e.centerX=187,e.centerY=359,e})(),DevMat03=(()=>{class e extends Mat{}return e.minX=34,e.minY=467,e.maxX=339,e.maxY=682,e.centerX=187,e.centerY=575,e})(),DevMat04=(()=>{class e extends Mat{}return e.minX=34,e.minY=683,e.maxX=339,e.maxY=898,e.centerX=187,e.centerY=791,e})(),DevMat05=(()=>{class e extends Mat{}return e.minX=340,e.minY=35,e.maxX=644,e.maxY=250,e.centerX=492,e.centerY=143,e})(),DevMat06=(()=>{class e extends Mat{}return e.minX=340,e.minY=251,e.maxX=644,e.maxY=466,e.centerX=492,e.centerY=359,e})(),DevMat07=(()=>{class e extends Mat{}return e.minX=340,e.minY=467,e.maxX=644,e.maxY=682,e.centerX=492,e.centerY=575,e})(),DevMat08=(()=>{class e extends Mat{}return e.minX=340,e.minY=683,e.maxX=644,e.maxY=898,e.centerX=492,e.centerY=791,e})(),DevMat09=(()=>{class e extends Mat{}return e.minX=645,e.minY=35,e.maxX=949,e.maxY=250,e.centerX=797,e.centerY=143,e})(),DevMat10=(()=>{class e extends Mat{}return e.minX=645,e.minY=251,e.maxX=949,e.maxY=466,e.centerX=797,e.centerY=359,e})(),DevMat11=(()=>{class e extends Mat{}return e.minX=645,e.minY=467,e.maxX=949,e.maxY=682,e.centerX=797,e.centerY=575,e})(),DevMat12=(()=>{class e extends Mat{}return e.minX=645,e.minY=683,e.maxX=949,e.maxY=898,e.centerX=797,e.centerY=791,e})(),RingMat=(()=>{class e extends Mat{static isInsideCircle(e,t){const n=e-this.centerX,i=t-this.centerY;return Math.sqrt(n*n+i*i)<this.radius}static isInFrontOfBlueLine(e){return!(e<this.blueLineY)}static isInFrontOfGreenLine(e){return!(e>this.greenLineY)}}return e.minX=45,e.minY=45,e.maxX=455,e.maxY=455,e.centerX=250,e.centerY=250,e.radius=190,e.blueLineY=88,e.greenLineY=410,e.startPointBlueSideX=250,e.startPointBlueSideY=198,e.startPointGreenSideX=250,e.startPointGreenSideY=300,e})(),SimpleTileMat=(()=>{class e extends TileMat{}return e.minX=98,e.minY=142,e.maxX=402,e.maxY=358,e.centerX=250,e.centerY=250,e.matrixMinX=98,e.matrixMinY=142,e.matrixMaxX=402,e.matrixMaxY=358,e.matrixRows=5,e.matrixColumns=7,e})();class StandardId{static getIdName(e){for(const t of this.idTable)if(t.id===e)return t.name}static includes(e){for(const t of this.idTable)if(t.name===e)return!0;return!1}}let SimpleCardAlphabet=(()=>{class e extends StandardId{}return e.names={markA:"markA",markB:"markB",markC:"markC",markD:"markD",markE:"markE",markF:"markF",markG:"markG",markH:"markH",markI:"markI",markJ:"markJ",markK:"markK",markL:"markL",markM:"markM",markN:"markN",markO:"markO",markP:"markP",markQ:"markQ",markR:"markR",markS:"markS",markT:"markT",markU:"markU",markV:"markV",markW:"markW",markX:"markX",markY:"markY",markZ:"markZ"},e.idTable=[{name:e.names.markA,id:3670337},{name:e.names.markB,id:3670338},{name:e.names.markC,id:3670339},{name:e.names.markD,id:3670340},{name:e.names.markE,id:3670341},{name:e.names.markF,id:3670342},{name:e.names.markG,id:3670343},{name:e.names.markH,id:3670344},{name:e.names.markI,id:3670345},{name:e.names.markJ,id:3670346},{name:e.names.markK,id:3670347},{name:e.names.markL,id:3670348},{name:e.names.markM,id:3670349},{name:e.names.markN,id:3670350},{name:e.names.markO,id:3670351},{name:e.names.markP,id:3670352},{name:e.names.markQ,id:3670353},{name:e.names.markR,id:3670354},{name:e.names.markS,id:3670355},{name:e.names.markT,id:3670356},{name:e.names.markU,id:3670357},{name:e.names.markV,id:3670358},{name:e.names.markW,id:3670359},{name:e.names.markX,id:3670360},{name:e.names.markY,id:3670361},{name:e.names.markZ,id:3670362}],e})(),Card=(()=>{class e extends StandardId{}return e.names={typhoonCard:"typhoonCard",rushCard:"rushCard",autoTackleCard:"autoTackleCard",randomCard:"randomCard",pushPowerUpCard:"pushPowerUpCard",haritePowerUpCard:"haritePowerUpCard",sideAttackCard:"sideAttackCard",easyModeCard:"easyModeCard",leftCard:"leftCard",rightCard:"rightCard",frontCard:"frontCard",backCard:"backCard",goCard:"goCard"},e.idTable=[{name:e.names.typhoonCard,id:3670016},{name:e.names.rushCard,id:3670054},{name:e.names.autoTackleCard,id:3670018},{name:e.names.randomCard,id:3670056},{name:e.names.pushPowerUpCard,id:3670020},{name:e.names.haritePowerUpCard,id:3670058},{name:e.names.sideAttackCard,id:3670022},{name:e.names.easyModeCard,id:3670060},{name:e.names.leftCard,id:3670024},{name:e.names.rightCard,id:3670062},{name:e.names.frontCard,id:3670026},{name:e.names.backCard,id:3670064},{name:e.names.goCard,id:3670028}],e})(),GameMark=(()=>{class e extends StandardId{}return e.names={craftFighter:"craftFighter",rythmAndGo:"rythmAndGo",skunkChaser:"skunkChaser",fingerStrike2P:"fingerStrike2P",fingerStrike1P:"fingerStrike1P",freeMove:"freeMove"},e.idTable=[{name:e.names.craftFighter,id:3670048},{name:e.names.rythmAndGo,id:3670052},{name:e.names.skunkChaser,id:3670086},{name:e.names.fingerStrike2P,id:3670050},{name:e.names.fingerStrike1P,id:3670088},{name:e.names.freeMove,id:3670084}],e})(),SimpleCardNumber=(()=>{class e extends StandardId{}return e.names={mark0:"mark0",mark1:"mark1",mark2:"mark2",mark3:"mark3",mark4:"mark4",mark5:"mark5",mark6:"mark6",mark7:"mark7",mark8:"mark8",mark9:"mark9"},e.idTable=[{name:e.names.mark0,id:3670320},{name:e.names.mark1,id:3670321},{name:e.names.mark2,id:3670322},{name:e.names.mark3,id:3670323},{name:e.names.mark4,id:3670324},{name:e.names.mark5,id:3670325},{name:e.names.mark6,id:3670326},{name:e.names.mark7,id:3670327},{name:e.names.mark8,id:3670328},{name:e.names.mark9,id:3670329}],e})(),Skunk=(()=>{class e extends StandardId{}return e.names={blueSkunk:"blueSkunk",greenSkunk:"greenSkunk",yellowSkunk:"yellowSkunk",orangeSkunk:"orangeSkunk",redSkunk:"redSkunk",brownSkunk:"brownSkunk"},e.idTable=[{name:e.names.blueSkunk,id:3670078},{name:e.names.greenSkunk,id:3670042},{name:e.names.yellowSkunk,id:3670080},{name:e.names.orangeSkunk,id:3670044},{name:e.names.redSkunk,id:3670082},{name:e.names.brownSkunk,id:3670046}],e})(),Sticker=(()=>{class e extends StandardId{}return e.names={speedUpSticker:"speedUpSticker",speedDownSticker:"speedDownSticker",wobbleSticker:"wobbleSticker",panicSticker:"panicSticker",spinSticker:"spinSticker",shockSticker:"shockSticker"},e.idTable=[{name:e.names.speedUpSticker,id:3670066},{name:e.names.speedDownSticker,id:3670030},{name:e.names.wobbleSticker,id:3670068},{name:e.names.panicSticker,id:3670032},{name:e.names.spinSticker,id:3670070},{name:e.names.shockSticker,id:3670034}],e})(),SimpleCardSymbol=(()=>{class e extends StandardId{}return e.names={markExclamation:"markExclamation",markUp:"markUp",markQuestion:"markQuestion",markPlus:"markPlus",markMinus:"markMinus",markEqual:"markEqual",markLeft:"markLeft",markDown:"markDown",markRight:"markRight",markMultiple:"markMultiple",markDivision:"markDivision",markPercent:"markPercent"},e.idTable=[{name:e.names.markExclamation,id:3670305},{name:e.names.markUp,id:3670366},{name:e.names.markQuestion,id:3670335},{name:e.names.markPlus,id:3670315},{name:e.names.markMinus,id:3670317},{name:e.names.markEqual,id:3670333},{name:e.names.markLeft,id:3670332},{name:e.names.markDown,id:3670367},{name:e.names.markRight,id:3670334},{name:e.names.markMultiple,id:3670314},{name:e.names.markDivision,id:3670319},{name:e.names.markPercent,id:3670309}],e})(),Id=(()=>{class e{static getStandardIdName(e){const t=[Card,Skunk,Sticker,GameMark,SimpleCardNumber,SimpleCardAlphabet,SimpleCardSymbol];for(const n of t){const t=n.getIdName(e);if(void 0!==t)return t}return e.toString()}}return e.Card=Card,e.GameMark=GameMark,e.Skunk=Skunk,e.Sticker=Sticker,e.SimpleCardNumber=SimpleCardNumber,e.SimpleCardAlphabet=SimpleCardAlphabet,e.SimpleCardSymbol=SimpleCardSymbol,e.ColorTileMat=ColorTileMat,e.RingMat=RingMat,e.SimpleTileMat=SimpleTileMat,e.DevMat01=DevMat01,e.DevMat02=DevMat02,e.DevMat03=DevMat03,e.DevMat04=DevMat04,e.DevMat05=DevMat05,e.DevMat06=DevMat06,e.DevMat07=DevMat07,e.DevMat08=DevMat08,e.DevMat09=DevMat09,e.DevMat10=DevMat10,e.DevMat11=DevMat11,e.DevMat12=DevMat12,e})();class P5tId extends Id{}class CubeChar{constructor(e){this.uuid="",this.characteristic=void 0,this.errStrInProgress="GATT operation already in progress.",this.timerID=0,this.retryInterval=30,this.executeTime=0,this.fps=15,this.maxRetryCount=20,this.service=e}prepare(){return new Promise((e,t)=>{this.service?this.service.getCharacteristic(this.uuid).then(t=>{this.characteristic=t,e("characteristic resolve")}).catch(e=>{t(e)}):t(new Error("service does not exist."))})}writeValue(e){const t=(new Date).getTime();if(t-this.executeTime>1e3/this.fps){this.executeTime=t;const n=0;return this.writeValueCore(e,n)}return Promise.resolve("writeValue ignored due to issuing too fast!! Please adjust framerate")}writeValueCore(e,t){return new Promise((n,i)=>{t>this.maxRetryCount&&n("writeValue ignored because it reaches max retry count"),void 0!==this.characteristic?this.characteristic.writeValue(e).then(()=>{n("writeValue resolved")}).catch(n=>{-1!==n.message.indexOf(this.errStrInProgress)?(clearTimeout(this.timerID),this.timerID=window.setTimeout(this.writeValueCore.bind(this,e,t+1),this.retryInterval)):i(n)}):i(new Error("characteristic does not exist."))})}readValue(){return new Promise((e,t)=>{void 0!==this.characteristic?this.characteristic.readValue().then(t=>{e(t)}).catch(e=>{-1!==e.message.indexOf(this.errStrInProgress)?(clearTimeout(this.timerID),this.timerID=window.setTimeout(this.readValue.bind(this),this.retryInterval)):t(e)}):t(new Error("characteristic does not exist."))})}setFrameRate(e){this.fps=e}}class CubeBatteryChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20108-5b3b-4571-9508-cf3efcd7bbae",this.batteryLevel=0,this.cbBatteryLevelChanged=[]}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;(null==t?void 0:t.value)&&this.setBatteryLevel(t.value)}),this.characteristic.startNotifications().then(()=>this.readBatteryLevel()).then(()=>{e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}getBatteryLevel(){return this.batteryLevel}readBatteryLevel(){return new Promise((e,t)=>{this.readValue().then(t=>{this.setBatteryLevel(t),e("Success")}).catch(e=>{t(e)})})}setBatteryLevel(e){const t=this.batteryLevel;this.batteryLevel=e.getUint8(0),t!==this.batteryLevel&&this.callbackBatteryLevel(this.batteryLevel)}addEventListener(e,t){"change"===e&&this.cbBatteryLevelChanged.push(t),this.callbackBatteryLevel(this.batteryLevel)}callbackBatteryLevel(e){for(const t of this.cbBatteryLevelChanged)null==t||t(e)}}class CubeButtonChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20107-5b3b-4571-9508-cf3efcd7bbae",this.buttonPressed=!1,this.cbBoth=[],this.cbPressed=[],this.cbReleased=[]}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;(null==t?void 0:t.value)&&(this.setButtonStatus(t.value),this.callbackButtonStatus(this.buttonPressed))}),this.characteristic.startNotifications().then(()=>this.readButtonStatus()).then(()=>{this.callbackButtonStatus(this.buttonPressed),e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}isButtonPressed(){return this.buttonPressed}readButtonStatus(){return new Promise((e,t)=>{this.readValue().then(t=>{this.setButtonStatus(t),e("Success")}).catch(e=>{t(e)})})}setButtonStatus(e){const t=e.getUint8(1);this.buttonPressed=128===t}addEventListener(e,t){"press"===e?this.cbPressed.push(t):"release"===e?this.cbReleased.push(t):"both"===e&&this.cbBoth.push(t),this.callbackButtonStatus(this.buttonPressed)}callbackButtonStatus(e){for(const t of this.cbBoth)null==t||t(e);for(const t of this.cbPressed)e&&(null==t||t());for(const t of this.cbReleased)e||null==t||t()}}class CubeIDChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20101-5b3b-4571-9508-cf3efcd7bbae",this.idInfo={positionId:void 0,standardId:void 0},this.cbPositionId=[],this.cbStandardId=[]}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;(null==t?void 0:t.value)&&this.setIdInfo(t.value)}),this.characteristic.startNotifications().then(()=>this.readIdInfo()).then(()=>{e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}getPositionId(){return this.idInfo.positionId}getStandardId(){return this.idInfo.standardId}readIdInfo(){return new Promise((e,t)=>{this.readValue().then(t=>{this.setIdInfo(t),e("Success")}).catch(e=>{t(e)})})}setIdInfo(e){const t=Object.assign({},this.idInfo);if(1===e.getUint8(0)){const n=1,i=3,r=5,a=7,s=9;if(this.idInfo.positionId={centerX:e.getUint16(n,!0),centerY:e.getUint16(i,!0),angle:e.getUint16(r,!0),sensorX:e.getUint16(a,!0),sensorY:e.getUint16(s,!0)},this.isPositionIdUpdated(t.positionId,this.idInfo.positionId))for(const e of this.cbPositionId)null==e||e(this.idInfo.positionId)}else if(2===e.getUint8(0)){const n=1,i=5;if(this.idInfo.standardId={idNum:e.getUint32(n,!0),id:Id.getStandardIdName(e.getUint32(n,!0)),angle:e.getUint16(i,!0)},this.isStandardIdUpdated(t.standardId,this.idInfo.standardId))for(const e of this.cbStandardId)null==e||e(this.idInfo.standardId)}else if(3===e.getUint8(0)){this.idInfo.positionId=void 0;for(const e of this.cbPositionId)null==e||e(this.idInfo.positionId)}else if(4===e.getUint8(0)){this.idInfo.standardId=void 0;for(const e of this.cbStandardId)null==e||e(this.idInfo.standardId)}}isPositionIdUpdated(e,t){return(null==e?void 0:e.centerX)!==(null==t?void 0:t.centerX)||((null==e?void 0:e.centerY)!==(null==t?void 0:t.centerY)||((null==e?void 0:e.angle)!==(null==t?void 0:t.angle)||((null==e?void 0:e.sensorX)!==(null==t?void 0:t.sensorX)||(null==e?void 0:e.sensorY)!==(null==t?void 0:t.sensorY))))}isStandardIdUpdated(e,t){return(null==e?void 0:e.id)!==(null==t?void 0:t.id)||((null==e?void 0:e.idNum)!==(null==t?void 0:t.idNum)||(null==e?void 0:e.angle)!==(null==t?void 0:t.angle))}callbackCurrentInfo(){for(const e of this.cbPositionId)null==e||e(this.idInfo.positionId);for(const e of this.cbStandardId)null==e||e(this.idInfo.standardId)}addEventListener(e,t){"positionid"===e?this.cbPositionId.push(t):"standardid"===e&&this.cbStandardId.push(t),this.callbackCurrentInfo()}}class CubeLightChar extends CubeChar{constructor(){super(...arguments),this.uuid="10b20103-5b3b-4571-9508-cf3efcd7bbae",this.cmdId={turnOff:1,turnOn:3}}turnLightOff(){const e=new Uint8Array([this.cmdId.turnOff]);this.writeValue(e)}turnLightOnRGB(e,t,n,i=0){this.turnLightOnRGBA(e,t,n,255,i)}turnLightOnRGBA(e,t,n,i,r=0){const a=new Uint8Array([this.cmdId.turnOn,CubeUtil.clipNumberUInt8(Math.floor(r/10)),1,1,CubeUtil.clipNumberUInt8(Math.floor(e*i/255)),CubeUtil.clipNumberUInt8(Math.floor(t*i/255)),CubeUtil.clipNumberUInt8(Math.floor(n*i/255))]);this.writeValue(a)}}let CubeMotorChar=(()=>{class e extends CubeChar{constructor(){super(...arguments),this.uuid="10b20102-5b3b-4571-9508-cf3efcd7bbae",this.cmdId={motorControl:1,motorControlTimeSpecified:2,motorControlAimSpecified:3,motorControlMultiAimSpecified:4,motorControlAccelerationSpecified:5},this.motorId={left:1,right:2},this.dirId={front:1,back:2},this.sequenceId=0}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;null==t||t.value}),this.characteristic.startNotifications().then(()=>{e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}getMotorDirection(e){return e>=0?this.dirId.front:this.dirId.back}motorControl(e,t){this.motorControlTimeSpecified(e,t)}motorControlTimeSpecified(e,t,n=0){const i=new Uint8Array([this.cmdId.motorControlTimeSpecified,this.motorId.left,this.getMotorDirection(e),CubeUtil.clipNumberUInt8(Math.abs(e)),this.motorId.right,this.getMotorDirection(t),CubeUtil.clipNumberUInt8(Math.abs(t)),CubeUtil.clipNumberUInt8(n)]);this.writeValue(i)}motorControlAimSpecified(t,n,i=e.moveTypeId.efficient,r=e.easeTypeId.constant,a=5){const s=new ArrayBuffer(13),o=new DataView(s);let d=0;o.setUint8(d,this.cmdId.motorControlAimSpecified),d+=1,o.setUint8(d,this.sequenceId),d+=1,o.setUint8(d,CubeUtil.clipNumberUInt8(a)),d+=1,o.setUint8(d,CubeUtil.clipNumberUInt8(i)),d+=1,o.setUint8(d,CubeUtil.clipNumberUInt8(n)),d+=1,o.setUint8(d,CubeUtil.clipNumberUInt8(r)),d+=1,o.setUint8(d,0),d+=1,o.setUint16(d,CubeUtil.clipNumberUInt16(t.x),!0),d+=2,o.setUint16(d,CubeUtil.clipNumberUInt16(t.y),!0),d+=2;const c=void 0===t.angle?0:t.angle,l=void 0===t.angleType?e.angleTypeId.noRotate:t.angleType;o.setUint16(d,CubeUtil.clipNumberUInt16(c+(l<<13)),!0),this.writeValue(s),this.inclementSequenceId()}inclementSequenceId(){this.sequenceId+=1,this.sequenceId>255&&(this.sequenceId=0)}motorControlMultipleAimSpecified(t,n,i=e.moveTypeId.efficient,r=e.easeTypeId.constant,a=!1,s=5){const o=8+6*t.length,d=new ArrayBuffer(o),c=new DataView(d);let l=0;c.setUint8(l,this.cmdId.motorControlMultiAimSpecified),l+=1,c.setUint8(l,this.sequenceId),l+=1,c.setUint8(l,CubeUtil.clipNumberUInt8(s)),l+=1,c.setUint8(l,CubeUtil.clipNumberUInt8(i)),l+=1,c.setUint8(l,CubeUtil.clipNumberUInt8(n)),l+=1,c.setUint8(l,CubeUtil.clipNumberUInt8(r)),l+=1,c.setUint8(l,0),l+=1,c.setUint8(l,a?1:0),l+=1;for(const n of t){c.setUint16(l,CubeUtil.clipNumberUInt16(n.x),!0),l+=2,c.setUint16(l,CubeUtil.clipNumberUInt16(n.y),!0),l+=2;const t=void 0===n.angle?0:n.angle,i=void 0===n.angleType?e.angleTypeId.noRotate:n.angleType;c.setUint16(l,CubeUtil.clipNumberUInt16(t+(i<<13)),!0),l+=2}this.writeValue(new Uint8Array(d)),this.inclementSequenceId()}motorControlAccelerationSpecified(){const e=new Uint8Array([5,50,5,15,0,0,0,0,100]);this.writeValue(e)}}return e.moveTypeId={efficient:0,withoutBack:1,rotate1st:2},e.easeTypeId={constant:0,accel:1,decel:2,accelDecel:3},e.angleTypeId={absEfficient:0,absPositiveDir:1,absNegativeDir:2,relPositiveDir:3,relNegativeDir:4,noRotate:5,sameAsCurrent:6},e})(),CubeSensorChar=(()=>{class e extends CubeChar{constructor(){super(...arguments),this.uuid="10b20106-5b3b-4571-9508-cf3efcd7bbae",this.sensorInfo={flat:!1,posture:e.postureId.top},this.cbFlat=[],this.cbCollision=[],this.cbDoubleTapped=[],this.cbPostureChanged=[]}prepare(){return new Promise((e,t)=>{super.prepare().then(()=>{this.characteristic?(this.characteristic.addEventListener("characteristicvaluechanged",e=>{const t=e.target;(null==t?void 0:t.value)&&this.setSensorInfo(t.value)}),this.characteristic.startNotifications().then(()=>this.readSensorInfo()).then(()=>{e("characteristic resolve")}).catch(e=>{t(e)})):t(new Error("characteristic does not exist."))}).catch(e=>{t(e)})})}isFlat(){return this.sensorInfo.flat}getPosture(){return this.sensorInfo.posture}readSensorInfo(){return new Promise((e,t)=>{this.readValue().then(t=>{this.setSensorInfo(t),e("Success")}).catch(e=>{t(e)})})}setSensorInfo(e){const t=Object.assign({},this.sensorInfo);if(1===e.getUint8(0)){const n=1,i=2,r=3,a=4;if(e.getUint8(r))for(const e of this.cbDoubleTapped)null==e||e();if(e.getUint8(i))for(const e of this.cbCollision)null==e||e();if(this.sensorInfo.flat=!!e.getUint8(n),t.flat!==this.sensorInfo.flat)for(const e of this.cbFlat)null==e||e(this.sensorInfo.flat);if(this.sensorInfo.posture=this.convertPostureValueToId(e.getUint8(a)),t.posture!==this.sensorInfo.posture)for(const e of this.cbPostureChanged)null==e||e(this.sensorInfo.posture)}}callbackCurrentInfo(){for(const e of this.cbFlat)null==e||e(this.sensorInfo.flat);for(const e of this.cbPostureChanged)null==e||e(this.sensorInfo.posture)}addEventListener(e,t){"flat"===e?this.cbFlat.push(t):"collision"===e?this.cbCollision.push(t):"doubletap"===e?this.cbDoubleTapped.push(t):"posture"===e&&this.cbPostureChanged.push(t),this.callbackCurrentInfo()}convertPostureValueToId(t){if(t<1||t>6)return"invalid";return[e.postureId.top,e.postureId.bottom,e.postureId.back,e.postureId.front,e.postureId.right,e.postureId.left][t-1]}}return e.postureId={top:"top",bottom:"bottom",back:"back",front:"front",right:"right",left:"left"},e})(),CubeSoundChar=(()=>{class e extends CubeChar{constructor(){super(...arguments),this.uuid="10b20104-5b3b-4571-9508-cf3efcd7bbae",this.cmdId={soundEffect:2,playNote:3}}playSE(e){const t=new Uint8Array([this.cmdId.soundEffect,CubeUtil.clipNumberUInt8(e),255]);this.writeValue(t)}playSingleNote(e,t=30){let n=e;n>128&&(n=128);const i=new Uint8Array([this.cmdId.playNote,1,1,CubeUtil.clipNumberUInt8(t),CubeUtil.clipNumberUInt8(n),255]);this.writeValue(i)}playMelody(e){const t=[],n=e.length;t.push(this.cmdId.playNote,1,n);for(const n of e)n.note>128&&(n.note=128),t.push(CubeUtil.clipNumberUInt8(n.duration),CubeUtil.clipNumberUInt8(n.note),255);this.writeValue(new Uint8Array(t))}}return e.seId={enter:0,selected:1,cancel:2,cursor:3,matIn:4,matOut:5,get1:6,get2:7,get3:8,effect1:9,effect2:10},e})();class CubeBase{constructor(e){this.idChar=void 0,this.motorChar=void 0,this.lightChar=void 0,this.sensorChar=void 0,this.batteryChar=void 0,this.soundChar=void 0,this.buttonChar=void 0,this.device=void 0,this.charStatusArray=[!1,!1,!1,!1,!1,!1,!1],this.isConnected=!1,this.device=e}connect(){return new Promise((e,t)=>{const{device:n}=this;if(n){const{gatt:i}=n;i?null==i||i.connect().then(e=>{this.isConnected=!0;return e.getPrimaryService("10b20100-5b3b-4571-9508-cf3efcd7bbae")}).then(n=>{const i=[];i.push(this.idChar=new CubeIDChar(n)),i.push(this.motorChar=new CubeMotorChar(n)),i.push(this.lightChar=new CubeLightChar(n)),i.push(this.sensorChar=new CubeSensorChar(n)),i.push(this.batteryChar=new CubeBatteryChar(n)),i.push(this.soundChar=new CubeSoundChar(n)),i.push(this.buttonChar=new CubeButtonChar(n));for(let n=0;n<i.length;n++){const r=i[n];null==r||r.prepare().then(()=>{this.updateCharState(n,!0)&&e(this)}).catch(e=>{t(e)})}}).catch(e=>{t(e)}):t(new Error("device.gatt does not exist."))}else t(new Error("device: BluetoothDevice does not exist."))})}disconnect(){const{device:e}=this;if(e&&this.isConnected){const{gatt:t}=e;t&&(this.isConnected=!1,t.disconnect(),this.initDeviceInfo())}}initDeviceInfo(){this.idChar=void 0,this.motorChar=void 0,this.lightChar=void 0,this.sensorChar=void 0,this.batteryChar=void 0,this.soundChar=void 0,this.buttonChar=void 0,this.device=void 0}updateCharState(e,t){this.charStatusArray[e]=t;for(const e of this.charStatusArray)if(!e)return!1;return!0}setFrameRate(e){var t,n,i,r,a,s,o;null===(t=this.idChar)||void 0===t||t.setFrameRate(e),null===(n=this.motorChar)||void 0===n||n.setFrameRate(e),null===(i=this.lightChar)||void 0===i||i.setFrameRate(e),null===(r=this.sensorChar)||void 0===r||r.setFrameRate(e),null===(a=this.batteryChar)||void 0===a||a.setFrameRate(e),null===(s=this.soundChar)||void 0===s||s.setFrameRate(e),null===(o=this.buttonChar)||void 0===o||o.setFrameRate(e)}}let Cube=(()=>{class e{constructor(e){this.x=void 0,this.y=void 0,this.sensorX=void 0,this.sensorY=void 0,this.angle=void 0,this.standardId=void 0,this.flat=void 0,this.posture=void 0,this.buttonPressed=void 0,this.batteryLevel=void 0,this.cube=void 0,this.cube=e,this.registCallback()}connect(){return new Promise((e,t)=>{const{cube:n}=this;n?n.connect().then(()=>{e(this)}).catch(e=>{t(e)}):t(new Error("cube does not exist."))})}disconnect(){const{cube:e}=this;null==e||e.disconnect()}addEventListener(e,t){var n,i,r,a,s,o,d,c,l,u,h,m,v,b,C,f,p,k;switch(e){case"buttonpress":null===(i=null===(n=this.cube)||void 0===n?void 0:n.buttonChar)||void 0===i||i.addEventListener("press",t);break;case"buttonrelease":null===(a=null===(r=this.cube)||void 0===r?void 0:r.buttonChar)||void 0===a||a.addEventListener("release",t);break;case"batterylevelchange":null===(o=null===(s=this.cube)||void 0===s?void 0:s.batteryChar)||void 0===o||o.addEventListener("change",t);break;case"sensorflat":null===(c=null===(d=this.cube)||void 0===d?void 0:d.sensorChar)||void 0===c||c.addEventListener("flat",t);break;case"sensorcollision":null===(u=null===(l=this.cube)||void 0===l?void 0:l.sensorChar)||void 0===u||u.addEventListener("collision",t);break;case"sensordoubletap":null===(m=null===(h=this.cube)||void 0===h?void 0:h.sensorChar)||void 0===m||m.addEventListener("doubletap",t);break;case"sensorposturechange":null===(b=null===(v=this.cube)||void 0===v?void 0:v.sensorChar)||void 0===b||b.addEventListener("posture",t);break;case"positionid":null===(f=null===(C=this.cube)||void 0===C?void 0:C.idChar)||void 0===f||f.addEventListener("positionid",t);break;case"standardid":null===(k=null===(p=this.cube)||void 0===p?void 0:p.idChar)||void 0===k||k.addEventListener("standardid",t)}}registCallback(){var e,t,n,i,r,a,s,o,d,c,l,u,h,m,v,b,C,f;null===(t=null===(e=this.cube)||void 0===e?void 0:e.buttonChar)||void 0===t||t.addEventListener("press",this.onButtonPressed.bind(this)),null===(i=null===(n=this.cube)||void 0===n?void 0:n.buttonChar)||void 0===i||i.addEventListener("release",this.onButtonReleased.bind(this)),null===(a=null===(r=this.cube)||void 0===r?void 0:r.batteryChar)||void 0===a||a.addEventListener("change",this.onBatteryLevelChanged.bind(this)),null===(o=null===(s=this.cube)||void 0===s?void 0:s.sensorChar)||void 0===o||o.addEventListener("flat",this.onFlatChanged.bind(this)),null===(c=null===(d=this.cube)||void 0===d?void 0:d.sensorChar)||void 0===c||c.addEventListener("collision",this.onCollisionOccurred.bind(this)),null===(u=null===(l=this.cube)||void 0===l?void 0:l.sensorChar)||void 0===u||u.addEventListener("doubletap",this.onDoubleTapped.bind(this)),null===(m=null===(h=this.cube)||void 0===h?void 0:h.sensorChar)||void 0===m||m.addEventListener("posture",this.onPostureChanged.bind(this)),null===(b=null===(v=this.cube)||void 0===v?void 0:v.idChar)||void 0===b||b.addEventListener("positionid",this.onPositionIdChanged.bind(this)),null===(f=null===(C=this.cube)||void 0===C?void 0:C.idChar)||void 0===f||f.addEventListener("standardid",this.onStandardIdChanged.bind(this))}onButtonPressed(){this.buttonPressed=!0,"function"==typeof cubeButtonPressed&&cubeButtonPressed()}onButtonReleased(){this.buttonPressed=!1,"function"==typeof cubeButtonReleased&&cubeButtonReleased()}onBatteryLevelChanged(e){this.batteryLevel=e,"function"==typeof cubeBatteryLevelChanged&&cubeBatteryLevelChanged(e)}onFlatChanged(e){this.flat=e,"function"==typeof cubeFlatChanged&&cubeFlatChanged(e)}onCollisionOccurred(){"function"==typeof cubeCollisionOccurred&&cubeCollisionOccurred()}onDoubleTapped(){"function"==typeof cubeDoubleTapped&&cubeDoubleTapped()}onPostureChanged(e){this.posture=e,"function"==typeof cubePostureChanged&&cubePostureChanged(e)}onPositionIdChanged(e){this.x=null==e?void 0:e.centerX,this.y=null==e?void 0:e.centerY,this.sensorX=null==e?void 0:e.sensorX,this.sensorY=null==e?void 0:e.sensorY,this.angle=null==e?void 0:e.angle,void 0!==this.angle&&(this.angle=this.radians(this.angle)),"function"==typeof cubePositionIdChanged&&cubePositionIdChanged(e)}onStandardIdChanged(e){this.standardId=null==e?void 0:e.id,this.angle=null==e?void 0:e.angle,void 0!==this.angle&&(this.angle=this.radians(this.angle)),"function"==typeof cubeStandardIdChanged&&cubeStandardIdChanged(e)}setFrameRate(e){var t;null===(t=this.cube)||void 0===t||t.setFrameRate(e)}turnLightOff(){var e,t;null===(t=null===(e=this.cube)||void 0===e?void 0:e.lightChar)||void 0===t||t.turnLightOff()}turnLightOnRGB(e,t,n,i=0){var r,a;null===(a=null===(r=this.cube)||void 0===r?void 0:r.lightChar)||void 0===a||a.turnLightOnRGB(e,t,n,i)}turnLightOnRGBA(e,t,n,i,r=0){var a,s;null===(s=null===(a=this.cube)||void 0===a?void 0:a.lightChar)||void 0===s||s.turnLightOnRGBA(e,t,n,i,r)}playSE(e){var t,n;null===(n=null===(t=this.cube)||void 0===t?void 0:t.soundChar)||void 0===n||n.playSE(e)}playSingleNote(e,t=30){var n,i;null===(i=null===(n=this.cube)||void 0===n?void 0:n.soundChar)||void 0===i||i.playSingleNote(e,t)}playMelody(e){var t,n;null===(n=null===(t=this.cube)||void 0===t?void 0:t.soundChar)||void 0===n||n.playMelody(e)}stop(){var e,t;return null===(t=null===(e=this.cube)||void 0===e?void 0:e.motorChar)||void 0===t?void 0:t.motorControl(0,0)}move(e,t,n=0){var i,r;return null===(r=null===(i=this.cube)||void 0===i?void 0:i.motorChar)||void 0===r?void 0:r.motorControlTimeSpecified(e,t,n)}moveTo(e,t,n=CubeMotorChar.moveTypeId.efficient,i=CubeMotorChar.easeTypeId.constant,r=5){var a,s;return(null==e?void 0:e.angle)&&(e.angle=this.degrees(e.angle)),null===(s=null===(a=this.cube)||void 0===a?void 0:a.motorChar)||void 0===s?void 0:s.motorControlAimSpecified(e,t,n,i,r)}moveToMulti(e,t,n=CubeMotorChar.moveTypeId.efficient,i=CubeMotorChar.easeTypeId.constant,r=!1,a=5){var s,o;for(const t of e)(null==t?void 0:t.angle)&&(t.angle=this.degrees(t.angle));return null===(o=null===(s=this.cube)||void 0===s?void 0:s.motorChar)||void 0===o?void 0:o.motorControlMultipleAimSpecified(e,t,n,i,r,a)}moveToCube(e,t,n=CubeMotorChar.moveTypeId.efficient,i=CubeMotorChar.easeTypeId.constant,r=5){(null==e?void 0:e.x)&&(null==e?void 0:e.y)&&(this.distanceToCube(e)>30?this.moveTo({x:e.x,y:e.y},t,n,i,r):this.stop())}rotate(e,t=0){var n,i;let r=e,a=-e;return e<0&&(r=-e,a=e),null===(i=null===(n=this.cube)||void 0===n?void 0:n.motorChar)||void 0===i?void 0:i.motorControlTimeSpecified(r,a,t)}turnTo(t,n,i=e.rotateTypeId.efficient,r=5){var a,s;let o;switch(i){case e.rotateTypeId.clockwise:o=e.angleTypeId.absPositiveDir;break;case e.rotateTypeId.counterClockwise:o=e.angleTypeId.absNegativeDir;break;default:case e.rotateTypeId.efficient:o=e.angleTypeId.absEfficient}if(this.x&&this.y){const e={x:this.x,y:this.y,angle:this.degrees(t),angleType:o};return null===(s=null===(a=this.cube)||void 0===a?void 0:a.motorChar)||void 0===s?void 0:s.motorControlAimSpecified(e,n,void 0,void 0,r)}}turnToXY(t,n,i,r=e.rotateTypeId.efficient,a=5){const s=this.relativeAngleToXY(t,n);let o=i;void 0!==this.angle&&Math.abs(s-this.angle)<Math.PI/6&&(o=10),this.turnTo(s,o,r,a)}turnToCube(t,n,i=e.rotateTypeId.efficient,r=5){(null==t?void 0:t.x)&&(null==t?void 0:t.y)&&this.turnToXY(t.x,t.y,n,i,r)}distanceToXY(e,t){if(this.x&&this.y){const n=this.x-e,i=this.y-t;return Math.sqrt(n*n+i*i)}return 0}distanceToCube(e){return(null==e?void 0:e.x)&&(null==e?void 0:e.y)?this.distanceToXY(e.x,e.y):0}relativeAngleToXY(e,t){if(this.x&&this.y){const n=e-this.x,i=t-this.y;return this.normalizeAngleRadian(Math.atan2(i,n))}return 0}degrees(e){const t=180*e/Math.PI;return this.normalizeAngleDegrees(Math.floor(t))}radians(e){const t=e*Math.PI/180;return this.normalizeAngleRadian(t)}normalizeAngleDegrees(e){let t=0;return t=e%360,e<0&&(t+=360),t}normalizeAngleRadian(e){let t=e;for(;t>Math.PI||t<-Math.PI;)t<-Math.PI?t+=2*Math.PI:t>Math.PI&&(t-=2*Math.PI);return t}}return e.seId=CubeSoundChar.seId,e.postureId=CubeSensorChar.postureId,e.moveTypeId=CubeMotorChar.moveTypeId,e.easeTypeId=CubeMotorChar.easeTypeId,e.angleTypeId=CubeMotorChar.angleTypeId,e.rotateTypeId={efficient:"efficient",clockwise:"clockwise",counterClockwise:"counterClockwise"},e.connectNewCube=()=>new Promise((t,n)=>{CubeConnector.connectNewCube().then(n=>{t(new e(n))}).catch(e=>{n(e)})}),e})();class CubeScanner{static scanNewCube(){const e={filters:[{services:["10b20100-5b3b-4571-9508-cf3efcd7bbae"]}]};return new Promise((t,n)=>{const i=window.navigator;(null==i?void 0:i.bluetooth)?i.bluetooth.requestDevice(e).then(e=>{const n=new CubeBase(e);t(n)}):n(new Error("navigatorObj.bluetooth does not exist."))})}}let CubeConnector=(()=>{class e{}return e.connectNewCube=()=>new Promise((e,t)=>{CubeScanner.scanNewCube().then(e=>e.connect()).then(t=>{e(t)}).catch(e=>{t(e)})}),e})(),P5tCube=(()=>{class e extends Cube{connectP5tCube(){return new Promise((e,t)=>{super.connect().then(()=>{e(this)}).catch(e=>{t(e)})})}onPositionIdChanged(e){(null==e?void 0:e.angle)&&(e.angle=this.convertAngleFromRadians(e.angle)),super.onPositionIdChanged(e)}onStandardIdChanged(e){(null==e?void 0:e.angle)&&(e.angle=this.convertAngleFromRadians(e.angle)),super.onStandardIdChanged(e)}turnLightOn(e,t=0){var n,i;null===(i=null===(n=this.cube)||void 0===n?void 0:n.lightChar)||void 0===i||i.turnLightOnRGBA(red(e),green(e),blue(e),alpha(e),t)}moveTo(e,t,n=CubeMotorChar.moveTypeId.efficient,i=CubeMotorChar.easeTypeId.constant,r=5){(null==e?void 0:e.angle)&&(e.angle=this.convertAngleToRadians(e.angle)),super.moveTo(e,t,n,i,r)}moveToMulti(e,t,n=CubeMotorChar.moveTypeId.efficient,i=CubeMotorChar.easeTypeId.constant,r=!1,a=5){for(const t of e)(null==t?void 0:t.angle)&&(t.angle=this.convertAngleToRadians(t.angle));super.moveToMulti(e,t,n,i,r,a)}turnTo(t,n,i=e.rotateTypeId.efficient,r=5){const a=this.convertAngleToRadians(t);super.turnTo(a,n,i,r)}turnToXY(t,n,i,r=e.rotateTypeId.efficient,a=5){let s=this.relativeAngleToXY(t,n),o=i;void 0!==this.angle&&Math.abs(s-this.angle)<Math.PI/6&&(o=10),this.isAngleModeRadians()||(s=Math.floor(degrees(s)),s=this.normalizeAngleDegrees(s)),this.turnTo(s,o,r,a)}convertAngleToRadians(e){let t;return t=this.isAngleModeRadians()?e:radians(e),this.normalizeAngleRadian(t)}convertAngleFromRadians(e){let t;return t=this.isAngleModeRadians()?e:degrees(e),this.normalizeAngleDegrees(t)}isAngleModeRadians(){return 1===sin(Math.PI/2)}}return e.connectNewP5tCube=()=>new Promise((t,n)=>{CubeConnector.connectNewCube().then(n=>{t(new e(n))}).catch(e=>{n(e)})}),e})();